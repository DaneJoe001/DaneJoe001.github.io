# AI文档工具集

> **声明：** 本项目代码由AI辅助生成，不保证完全正确和最佳实践。使用前请仔细测试。  
> **Copyright © 2023-2025 DaneJoe001**
> **项目地址** https://github.com/DaneJoe001/AIDocTool

这是一个基于Qt的文档工具集合，目前包含目录树读取工具，允许用户浏览、过滤和导出文件系统中的目录和文件。

## 功能特点

### 目录树读取工具

- 图形界面：用户友好的图形界面，方便用户交互
- 目录树读取：
  - 可以指定要读取的目录
  - 可以设置搜索深度（1级、2级等）
  - 多线程处理，避免UI阻塞
- 文件过滤选项：
  - 支持通配符和正则表达式过滤
  - 支持类似.gitignore的过滤规则
  - 可以选择是否显示文件或仅显示目录
- 文本展示：
  - 在目录树右侧以文本方式展示读取的目录结构
  - 支持选择特定节点查看其子结构
  - 使用美观的树形连接线显示层次结构
- 导出功能：
  - 可将当前展示的文本内容导出为TXT文件
- 其他功能：
  - 层叠页面设计，便于未来添加其他功能
  - 显示读取的目录树结构
  - 支持取消操作，避免长时间等待
  - 帮助文档和开发者信息

### 文件合并功能

1. 可以递归搜索指定目录中的文本文件
2. 支持通配符和正则表达式选择文件
3. 支持自定义包含规则，指定要合并的文件类型
4. 可以设置文件头模板，添加自定义信息
5. 可以使用分隔符分隔不同文件的内容
6. 支持使用正则表达式提取文件中的特定内容
7. 可以将合并结果导出为TXT文件或复制到剪贴板

## 构建要求

- Qt 6.5.3 或更高版本
- CMake 3.16 或更高版本
- 支持C++17的编译器

## 构建步骤

1. 克隆或下载此仓库
2. 创建构建目录：
   ```
   mkdir build
   cd build
   ```
3. 配置和构建项目：
   ```
   cmake ..
   cmake --build .
   ```
4. 运行应用程序：
   ```
   ./aidoctools
   ```

## 使用说明

### 目录树读取工具

1. 点击"浏览..."按钮选择要读取的目录
2. 设置搜索深度（默认为3级）
3. 根据需要配置过滤选项：
   - 勾选"启用文件过滤"以过滤文件
   - 选择使用通配符（如 *.txt）或正则表达式（如 .*\.txt）
   - 在过滤规则文本框中输入类似.gitignore的规则
4. 勾选"读取文件名"以显示文件，或取消勾选仅显示目录
5. 点击"开始读取"按钮开始处理
6. 如需取消操作，点击"取消"按钮
7. 在右侧文本区域查看目录结构的文本表示
8. 可以通过"文件"菜单中的"导出为TXT文件"选项导出文本内容
9. 可以通过"文件"菜单中的"导入过滤规则"选项导入过滤规则文件
10. 通过"视图"菜单可以切换到"文件合并工具"功能

### 文件合并功能

1. 可以递归搜索指定目录中的文本文件
2. 支持通配符和正则表达式选择文件
3. 支持自定义包含规则，指定要合并的文件类型
4. 可以设置文件头模板，添加自定义信息
5. 可以使用分隔符分隔不同文件的内容
6. 支持使用正则表达式提取文件中的特定内容
7. 可以将合并结果导出为TXT文件或复制到剪贴板

## 项目结构

```
AIDocTools/
├── include/                  # 头文件目录
│   ├── directorytreereader.h # 目录树读取器类
│   ├── filemerger.h          # 文件合并器类
│   ├── filemergerwidget.h    # 文件合并器界面类
│   └── mainwindow.h          # 主窗口类
├── source/                   # 源文件目录
│   ├── directorytreereader.cpp # 目录树读取器实现
│   ├── filemerger.cpp        # 文件合并器实现
│   ├── filemergerwidget.cpp  # 文件合并器界面实现
│   ├── main.cpp              # 程序入口
│   └── mainwindow.cpp        # 主窗口实现
├── resource/                 # 资源文件目录
│   ├── icons/                # 图标文件
│   │   └── main_icon.ico     # 主图标
│   └── resources.qrc         # Qt资源文件
├── build/                    # 构建目录（由CMake生成）
├── CMakeLists.txt            # CMake构建脚本
└── README.md                 # 项目说明文件
```

## 开发历史

### 初始版本 (v0.1)
- 创建基本的Qt应用程序框架
- 实现目录树读取功能
- 添加文件过滤功能（通配符和正则表达式）
- 添加搜索深度限制

### 功能增强 (v0.2)
- 添加文本展示功能，在右侧显示目录结构
- 实现导出为TXT文件功能
- 添加类似.gitignore的过滤规则支持
- 实现层叠页面设计，为未来扩展做准备

### 界面优化 (v0.3)
- 改进树形结构显示格式，使用连接线（如 ├── 和 └──）
- 优化UI布局和交互体验
- 添加程序图标
- 确保文本区域中的内容可以复制

### 代码重构 (v0.4)
- 将目录树读取功能封装为独立模块 (DirectoryTreeReader类)
- 优化代码结构，实现高内聚低耦合
- 添加Doxygen风格的代码注释
- 修复过滤规则不正常工作的问题

### 功能扩展 (v0.5)
- 添加文件合并功能
- 实现文本文件内容提取和合并
- 支持自定义文件头模板和分隔符
- 添加正则表达式内容提取功能
- 实现合并结果导出和复制功能

### 过滤功能优化 (v0.6)
- 使用C++17的std::filesystem库改进路径处理和匹配逻辑
- 解决目录过滤问题，特别是针对包含规则的处理
- 优化build目录的自动排除逻辑
- 改进文件类型包含规则的处理，允许正确遍历所有目录查找匹配文件
- 增强路径规范化和匹配算法，支持多种路径格式和分隔符
- 添加详细的调试输出，帮助诊断过滤规则匹配过程
- 完善目录遍历逻辑，确保包含规则和排除规则的协同工作

### 帮助功能优化与多线程支持 (v0.7)
- 添加帮助菜单，提供"使用帮助"和"关于"信息
- 使用Qt Concurrent框架实现目录读取的多线程处理
- 修复目录检索时UI阻塞的问题
- 确保线程安全的UI更新，增强应用程序响应性
- 添加线程同步逻辑，提高操作稳定性和可靠性
- 添加自定义应用程序图标，提升专业性和可识别性
- 优化发布版本，移除控制台输出，实现单可执行程序分发

## 遇到的问题及解决方案

### 1. QMetaObject::invokeMethod 参数错误
- **问题**: 使用字符串形式的方法名调用QMetaObject::invokeMethod时出现编译错误
- **原因**: QTreeWidgetItem的addChild方法不是槽函数，不能通过字符串名称调用
- **解决方案**: 使用lambda函数替代字符串方法名，在主线程中安全地执行UI操作

### 2. 文本表示格式问题
- **问题**: 初始的文本表示格式不够直观
- **解决方案**: 实现了带有连接线的树形结构显示，使用 ├── 和 └── 符号

### 3. 过滤规则不正常工作
- **问题**: 过滤规则未能正确匹配文件和目录
- **解决方案**: 修复了过滤逻辑，确保正确处理通配符和正则表达式

### 4. 图标加载问题
- **问题**: 自定义图标无法正确加载
- **解决方案**: 使用Qt资源系统正确引用图标文件

### 5. 编译错误
- **问题**: QString::startsWith 参数类型错误
- **解决方案**: 将字符参数改为使用QChar或QStringLiteral

### 6. 多线程UI更新问题
- **问题**: 在后台线程中直接更新UI导致崩溃
- **解决方案**: 使用QMetaObject::invokeMethod确保在主线程中安全地更新UI

### 7. 目录过滤问题
- **问题**: 目录过滤规则无法正常工作，特别是在使用包含规则（如 *.cpp）时，过早地退出目录遍历
- **原因**: 过滤逻辑未区分文件和目录，当使用文件类型包含规则时，由于目录不匹配这些规则导致遍历提前结束
- **解决方案**: 
  - 使用C++17的std::filesystem库增强路径处理
  - 改进目录匹配算法，对目录和文件应用不同的过滤逻辑
  - 当存在文件类型包含规则时，允许继续遍历所有目录以查找匹配文件
  - 针对常见的build目录进行特殊处理，实现智能自动排除
  - 增强路径规范化，支持多种路径格式和分隔符

### 8. Windows SmartScreen警告
- **问题**: Windows Defender SmartScreen阻止未签名应用程序运行
- **原因**: 应用程序没有数字签名，被Windows视为潜在风险
- **解决方案**: 
  - 短期：用户可以点击"仍要运行"按钮允许程序执行
  - 长期：为应用程序添加数字签名（需要购买代码签名证书）
  - 添加自定义图标，使应用程序看起来更专业和可信

## 发布说明

### v0.7 发布版本
- 单可执行程序分发，无需安装
- 所有Qt依赖已打包，无需额外下载
- 移除控制台输出，提供纯GUI体验
- 添加自定义应用程序图标
- 支持Windows 10/11 64位系统

## 未来计划

1. 添加更多文档工具功能
2. 实现文件内容搜索功能
3. 添加文件比较工具
4. 支持导出为更多格式（如Markdown、HTML等）
5. 添加文件统计和分析功能 